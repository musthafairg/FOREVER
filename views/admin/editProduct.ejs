
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FOREVER. Admin Edit Products</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/admin.css"> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="/css/edit-product.css">
    </head>
<body>

<%- include("../../views/partials/admin/header") %>


<div class="main-layout" style="gap: 2%;">
        
    <aside class="sidebar">
        <nav class="sidebar-nav">
            <ul>
                <li class="<%= locals.page === 'dashboard' ? 'active' : '' %>">
                    <a href="/admin" style="color: inherit; text-decoration: none; display: flex; align-items: center; width: 100%; height: 100%;">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                </li>
               
                
                <li class="<%= locals.page === 'users' ? 'active' : '' %>">
                    <a href="/admin/users" style="color: inherit; text-decoration: none; display: flex; align-items: center; width: 100%; height: 100%;">
                        <i class="fas fa-users"></i>
                        Users
                    </a>
                </li>
                
                <li class="<%= locals.page === 'category' ? 'active' : '' %>">
                    <a href="/admin/category" style="color: inherit; text-decoration: none; display: flex; align-items: center; width: 100%; height: 100%;">
                        <i class="fas fa-folder-open"></i>
                        Category
                    </a>
                </li>
                
                <li class="<%= locals.page === 'products' ? 'active' : '' %>">
                        <a href="/admin/products" style="color: inherit; text-decoration: none; display: flex; align-items: center; width: 100%; height: 100%;">
                            <i class="fas fa-list"></i>
                            Products
                        </a>
                    </li>
                     <li >
                    <a href="/admin/orders"><i class="fas fa-box"></i>Orders</a>
                </li>
                <li >
                    <a href="/admin/sales-report"><i class="fas fa-chart-line"></i>Sales Report</a> 
                </li>
                 <li  >
                    <a href="/admin/stock"><i class="fa-solid fa-boxes-stacked"></i>Stock</a>
                </li>
                  <li  >
                    <a href="/admin/offers/product"><i class="fa-solid fa-tags"></i>Product Offer</a>
                </li>
                   <li  >
                    <a href="/admin/offers/category"><i class="fa-solid fa-tags"></i>Category Offer</a>
                </li>
                   <li >
          <a href="/admin/coupons"><i class="fa-solid fa-ticket"></i>Coupons</a>
        </li>
            </ul>
        </nav>
    </aside>

    <section class="content-main" style="width: 78%;">
 <div class="content-header row">
                <div class="d-flex justify-content-between align-items-center mb-4"> 
                    <h2 class="content-title card-title" 
                                    style="font-size: 1.5rem;
                    font-weight: 600;
                    margin-bottom: 30px;
                    margin-top: 29px;
                    color: #333;">
                    Edit New Products
                </h2>
                                </div>
            </div> 
        <div class="row">
          
            <div class="col-lg-12">
                <div class="card mb-4">
                    <div class="card-body">
                        <form method="POST" action="/admin/edit-product/<%=product._id%>" id="productForm" enctype="multipart/form-data"> 
                        
                            <input type="hidden" id="imageDatas" name="imageDatas"> 

                            <div class="mb-4">
                                <label for="product_name" class="form-label">Product Name</label>
                                <input type="text" placeholder="Type here" name="productName"
                                    class="form-control border" id="product_name" value="<%= product.productName%>">
                                <div id="productName-error" class="error-message"></div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="form-label">Full description</label>
                                <textarea placeholder="Type here" id="descriptionid" name="descriptionData" value="" class="form-control border"
                                    rows="4"><%=product.description%></textarea>
                                <div id="description-error" class="error-message"></div>
                            </div>
                            <div class="row">
                                <div class="col-lg-4">
                                    <div class="mb-4">
                                        <label class="form-label">Regular price</label>
                                        <input placeholder="$" name="regularPrice" type="text"
                                            class="form-control border" value="<%=product.regularPrice%>">
                                        <div id="regularPrice-error" class="error-message"></div>
                                    </div>
                                </div>
                               
                                <div class="col-lg-4">
                                    <div class="mb-4">
                                        <label class="form-label">Quantity</label>
                                        <input placeholder="" name="quantity" type="text" class="form-control border" value="<%= product.quantity%>">
                                        <div id="quantity-error" class="error-message"></div>
                                    </div>
                                </div>
                            </div>
                          
                            <div class="card mb-4">
                                <div class="card-body">
                                    <div class="row gx-2">
                                        <div class="col-sm-6 mb-3">
                                            <label class="form-label">Category</label>
                                            <select class="form-select border" style="width: 150px;" name="category">
                                                <% for (let i=0; i<category.length; i++){%>
                                                    <option value="<%= category[i].name%>">
                                                        <%= category[i].name%>
                                                    </option>
                                               <%}%>
                                            </select>
                                            <div id="category-error" class="error-message"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                           
                            <div class="card mb-2">

                                <div class="card-header">
                                    <h4>Existing images</h4>
                                </div>

                                <input type="hidden" id="ExistingImages" value="<%=product.productImage.length%>">
                                <% if (product.productImage && product.productImage.length > 0) { %>
                                    <% for(let i=0; i<product.productImage.length; i++){ %>
                                        <div class="col-md-12">
                                            <div class="mb-2 d-flex align-items-center">
                                                <input type="hidden"
                                                       value="<%=product.productImage[i]%>"
                                                       class="imageDatas">
                                                <img class="rounded" style="width: 50px; height: 60px;"
                                                     src="/uploads/image/<%=product.productImage[i]%>"
                                                     alt="">
                                                <button type="button"
                                                        class="btn btn-sm btn-link text-danger ms-2"
                                                        onclick="deleteProductImage('<%=product.productImage[i]%>','<%=product._id%>')">
                                                    <i class="fa-solid fa-xmark"></i>
                                                </button>
                                            </div>
                                        </div>
                                    <% } %>
                                <% } %>



                               <% if( product.productImage.length < 4){%>

                                <div class="card-header">
                                    <h4>Choose images</h4>
                                </div>
                                <div class="border row">
                                    <div id="addedImagesContainer" class="thumbnails-container"></div>
                                </div>

                                <%}%>
                                
                                 <% if( product.productImage.length == 0){%>
                                <div class="row">
                                    <div class="card-body align-items-center" style="margin-bottom: 20px;">
                                        <label class="form-label">Image 1</label>
                                        <input class="form-control" type="file" name="images" id="input1"
                                            accept="image/png, image/jpeg, image/jpg"
                                            onchange="onFileChange(event, 1)">
                                        <div id="images-error" class="error-message"></div>

                                        <div id="container1" class="crop-container" style="display:none;">
                                            <img id="mainImage1" class="crop-main-image" />
                                            <div id="crop-area1" class="crop-area"></div>
                                        </div>
                                        <button type="button" id="cropBtn1" class="btn-sm btn-primary mt-2" style="display:none;">
                                            Crop Image 1
                                        </button>
                                        <div id="preview1" class="crop-preview"></div>
                                    </div>
                                </div>

                                <%}%>

                                

                                <% if( product.productImage.length < 2 ){%>
                                <div class="row">
                                    <div class="card-body align-items-center" style="margin-bottom: 20px;">
                                        <label class="form-label">Image 2</label>
                                        <input class="form-control" type="file" name="images" id="input2"
                                            accept="image/png, image/jpeg, image/jpg"
                                            onchange="onFileChange(event, 2)">

                                        <div id="container2" class="crop-container" style="display:none;">
                                            <img id="mainImage2" class="crop-main-image" />
                                            <div id="crop-area2" class="crop-area"></div>
                                        </div>
                                        <button type="button" id="cropBtn2" class="btn-sm btn-primary mt-2" style="display:none;">
                                            Crop Image 2
                                        </button>
                                        <div id="preview2" class="crop-preview"></div>
                                    </div>
                                </div>

                                <%}%>
                               

                                <% if( product.productImage.length < 3 ){%>
                                <div class="row">
                                    <div class="card-body align-items-center" style="margin-bottom: 20px;">
                                        <label class="form-label">Image 3</label>
                                        <input class="form-control" type="file" name="images" id="input3"
                                            accept="image/png, image/jpeg, image/jpg"
                                            onchange="onFileChange(event, 3)">

                                        <div id="container3" class="crop-container" style="display:none;">
                                            <img id="mainImage3" class="crop-main-image" />
                                            <div id="crop-area3" class="crop-area"></div>
                                        </div>
                                        <button type="button" id="cropBtn3" class="btn-sm btn-primary mt-2" style="display:none;">
                                            Crop Image 3
                                        </button>
                                        <div id="preview3" class="crop-preview"></div>
                                    </div>
                                </div>

                                <%}%>
                                

                                <% if( product.productImage.length < 4 ){%>
                                <div class="row">
                                    <div class="card-body align-items-center" style="margin-bottom: 20px;">
                                        <label class="form-label">Image 4</label>
                                        <input class="form-control" type="file" name="images" id="input4"
                                            accept="image/png, image/jpeg, image/jpg"
                                            onchange="onFileChange(event, 4)">

                                        <div id="container4" class="crop-container" style="display:none;">
                                            <img id="mainImage4" class="crop-main-image" />
                                            <div id="crop-area4" class="crop-area"></div>
                                        </div>
                                        <button type="button" id="cropBtn4" class="btn-sm btn-primary mt-2" style="display:none;">
                                            Crop Image 4
                                        </button>
                                        <div id="preview4" class="crop-preview"></div>
                                    </div>
                                </div>

                                <%}%>
                            </div>

                            <div>
                                <button class="btn btn-md rounded font-sm hover-up" type="button" onclick="validateAndSubmit()" style="background-color: black; color: #f7f7f7;">Update</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
   </section>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

   
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="/js/edit-product.js"></script>
    