<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shop | Forever</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/shop.css">
  <script src="/js/header.js" defer></script>
  
</head>
<body>
  <%- include('../partials/user/header.ejs') %>

  <div class="main-container">
    <section class="shop-page container">
     <div class="shop-topbar">
    <div class="search-bar">
        <form action="/shop/" method="get" class="d-inline w-100">
            <div class="search-input-wrapper">
                <input 
                    type="text" 
                    class="search-input" 
                    placeholder="Search customers..." 
                    name="search"
                    value="<%= typeof search !== 'undefined' ? search : '' %>">
                
                <button class="search-btn" type="submit">
                    <i class="fas fa-search"></i>
                </button>

                <% if (search && search.length > 0) { %>
                    <a href="/shop" class="clear-btn">×</a>
                <% } %>
            </div>
        </form>
    </div>


     <form method="GET" id="sortForm">

      <% if (search){%>
        <input type="hidden" name="search" value="<%= search %>">

        <%}%>

            <% if (categoryId){%>
        <input type="hidden" name="category" value="<%= categoryId %>">

        <%}%>

         <% if (gt){%>
        <input type="hidden" name="gt" value="<%= gt %>">

        <%}%>

          <% if (lt){%>
        <input type="hidden" name="lt" value="<%= lt %>">

        <%}%>
        
  <select   name="sort" class="sort-select" onchange="document.getElementById('sortForm').submit()">
      <option value="">Sort By</option>
      <option value="priceLow" <%= sort === 'priceLow' ? 'selected' : '' %>>Price: Low to High</option>
      <option value="priceHigh" <%= sort === 'priceHigh' ? 'selected' : '' %>>Price: High to Low</option>
      <option value="az" <%= sort === 'az' ? 'selected' : '' %>>A → Z</option>
      <option value="za" <%= sort === 'za' ? 'selected' : '' %>>Z → A</option>
  </select>
</form>


</div>


      <div class="product-list-container">
        <aside class="sidebar">
          <div class="filter-section">
            <div class="filter-title">Categories</div>
            <div class="category-brand-container">
              <ul>
                <% for (let i = 0; i < category.length; i++) { %>
                  <li class="filter-item">
                    <a href="/filter?category=<%= category[i]._id %><%= search? '&search=' + search : '' %><%= sort? '&sort=' + sort : '' %>">
                      <%= category[i].name %></a>
                  </li>
                <% } %>
              </ul>
            </div>
          </div>

         

          <div class="price-filter">
            <div class="filter-title">Filter by Price</div>
            <form id="price-filter-form">
              <div class="price-options">
                <a href="/filter-by-price?gt=0&lt=500<%= search ? '&search=' + search : '' %><%= sort ? '&sort=' + sort : '' %>">
                <button type="button" class="price-button">Under ₹500</button></a>
                <a href="/filter-by-price?gt=500&lt=1000<%= search? '&search=' + search : '' %><%= sort? '&sort=' + sort : '' %>">
                  <button type="button" class="price-button">₹500 - ₹1000</button></a>
                <a href="/filter-by-price?gt=1000&lt=1500<%= search? '&search=' + search : '' %><%= sort? '&sort=' + sort : '' %>">
                  <button type="button" class="price-button">₹1000 - ₹1500</button></a>
                <a href="/filter-by-price?gt=1500&lt=1000000<%= search? '&search=' + search : '' %><%= sort? '&sort=' + sort : '' %>">
                  <button type="button" class="price-button">Above ₹1500</button></a>
              </div>
            </form>
          </div>

            <% if (categoryId || gt || lt || sort) { %>
    <a href="/shop<%= search ? '?search=' + search : '' %>" class="clear-filter-btn">
      Clear Filters
    </a>
  <% } %>
        </aside>


        <main class="product-grid">
          
          <% for (let i = 0; i < products.length; i++) { %>
            <div class="product-card">
                     <button 
  class="wishlist-btn"
  onclick="toggleWishlist('<%= products[i]._id %>', this.querySelector('i'))"
>

                  <i class="<%= wishlistItems.includes(products[i]._id.toString()) 
  ? 'fas fa-heart wishlist-active' 
  : 'far fa-heart' %>">
</i>

                </button>
              <a href="/product-details?id=<%= products[i]._id %>">
                <img src="/uploads/image/<%= products[i].productImage[0] %>" alt="<%= products[i].productName %>" />
                <h4><%= products[i].productName %></h4>
                
   <p>
  <% if (products[i].discountPercent > 0) { %>

    <span class="regular-price">
      ₹<%= products[i].regularPrice.toLocaleString('en-IN') %>
    </span>

    <span class="final-price" >
      ₹<%= products[i].finalPrice.toLocaleString('en-IN') %>
    </span>


  <% } else { %>

    ₹<%= products[i].regularPrice.toLocaleString('en-IN') %>

  <% } %>
</p>

              </a>
              <button
                  class="add-to-cart-btn"
                  onclick='handleAddToCart(
  "<%= products[i]._id %>",
  <%- JSON.stringify(products[i].variants || []) %>
)'
                >
                  Add to Cart
                </button>
            </div>
          <% } %>
        </main>
        
      </div>

     <div class="container mt-4">
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center mb-4">
                        <%for(let i=1; i<=totalPages;i++){%>
                            <li class="page-item <%=(i===currentPage) ? 'active' : '' %> ">
                                <a class="page-link" href="/shop?page=<%= i %><%= search ? '&search=' +search :'' %><%= sort ? '&sort=' +sort :'' %>">
                                    <%=i %>
                                </a>
                            </li>
                        <%}%>
                    </ul>
                </nav>
            </div>
    </section>
  </div>






<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
  <%- include('../partials/user/footer.ejs') %>

 <div id="sizeModal" class="size-modal">
  <div class="size-modal-content">

    <h5>Select Size</h5>

    <div id="sizeOptions"></div>

    <div id="variantDetails" style="display:none; margin-top:15px;">
      <p><strong>Price:</strong> <span id="selectedPrice"></span></p>
      <p><strong>Stock:</strong> <span id="selectedStock"></span></p>
    </div>

    <button onclick="confirmSize()">Confirm</button>

  </div>
</div>


  
  <script src="/js/shop.js"></script>
  
</body>
</html>
